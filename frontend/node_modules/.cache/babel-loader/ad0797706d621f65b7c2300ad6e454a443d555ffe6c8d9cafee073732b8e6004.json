{"ast":null,"code":"import axios from 'axios';\nimport SockJS from 'sockjs-client';\nimport Stomp from 'stompjs';\nexport default {\n  name: \"MyTickets\",\n  data() {\n    return {\n      tickets: [],\n      position: '',\n      infos: {}\n    };\n  },\n  mounted() {\n    this.getTickets();\n    this.getInfos();\n    // Establish a WebSocket connection using SockJS\n    const socket = new SockJS(\"http://localhost:8080/web-socket\");\n    this.client = Stomp.over(socket);\n\n    // Handle connection open event\n    this.client.connect({}, frame => {\n      console.log(frame);\n      console.log(\"WebSocket connection established.\");\n\n      // Subscribe to the topic where messages will be received\n      this.client.subscribe(\"/topic/queue/user/\" + this.infos.id, message => {\n        const body = JSON.parse(message.body);\n        console.log(\"Received message:\", body);\n\n        //  FONCTION ILLY TRAJA3LEK FL POSITION\n        let pos = document.getElementById(\"pos\" + body.idTicket);\n        pos.innerHTML = \"Position : \" + body.pos;\n        if (body.pos == 0) {\n          let etat = document.getElementById(\"etat\" + body.idTicket);\n          etat.innerHTML = \"EN COURS\";\n        }\n      });\n    });\n  },\n  methods: {\n    getTickets() {\n      axios.get(\"http://localhost:8080/tickets/today/enCours-enAttente\").then(res => {\n        this.tickets = res.data;\n        console.log(res.data);\n      }).catch(err => {\n        console.log(err);\n      });\n    },\n    async handleAnnuler(id) {\n      const response = await axios.put(\"http://localhost:8080/tickets/update/annuler/\" + id);\n      this.getTickets();\n      console.log(response);\n    },\n    async getPosition(id) {\n      const response = await axios.get(\"http://localhost:8080/tickets/queue/\" + id);\n      console.log(response.data);\n      let pos = document.getElementById(\"pos\" + id);\n      pos.innerHTML = \"Position : \" + response.data;\n    },\n    // Send a message to the server\n    sendMessage(message) {\n      this.client.send(\"/send-message\", {}, message);\n    },\n    getInfos() {\n      axios.get(\"http://localhost:8080/profile\").then(res => {\n        console.log(res.data);\n        this.infos = res.data;\n      }).catch(err => {\n        console.error(err);\n      });\n    }\n  },\n  computed: {\n    user() {\n      return this.$store.state.user;\n    },\n    type_admin() {\n      return this.$store.state.type_admin;\n    }\n  }\n};","map":{"version":3,"names":["axios","SockJS","Stomp","name","data","tickets","position","infos","mounted","getTickets","getInfos","socket","client","over","connect","frame","console","log","subscribe","id","message","body","JSON","parse","pos","document","getElementById","idTicket","innerHTML","etat","methods","get","then","res","catch","err","handleAnnuler","response","put","getPosition","sendMessage","send","error","computed","user","$store","state","type_admin"],"sources":["C:\\Users\\Ben Ali Sabeur\\Documents\\GitHub\\baladeyti\\frontend\\src\\views\\TodayTickets.vue"],"sourcesContent":["<template>\r\n<div >\r\n<section class=\"container\" v-if=\"user\" >\r\n<h1>Tickets d'Aujourd'hui</h1>\r\n  <div class=\"row\" >\r\n    <article class=\"card fl-left\" v-for=\"ticket in tickets\" :key=\"ticket.id\">\r\n      <section class=\"date\">\r\n        <time datetime=\"23th feb\">\r\n          <span>{{ticket.date.slice(8,10)}}</span><span>{{ticket.date.slice(5,7)}}</span>\r\n        </time>\r\n      </section>\r\n      <section class=\"card-cont\">\r\n        <h3>{{ticket.num}}</h3>\r\n        <div class=\"even-date\">\r\n         <i class=\"fa fa-calendar\"></i>\r\n         <time>\r\n           <span>{{ticket.idPersonne.nom}} {{ticket.idPersonne.prenom}}</span>\r\n           <span>{{ticket.idMunicipalite.nom}}</span>\r\n         </time>\r\n        </div>\r\n        <div class=\"even-info\">\r\n          <i class=\"fa fa-map-marker\"></i>\r\n          <p>\r\n            {{ticket.idService.nom}}\r\n          </p>\r\n        </div>\r\n        <img src=\"../assets/annulerTicket.png\" @click=\"handleAnnuler(ticket.id)\">\r\n        <a :id=\"'etat' + ticket.id\" href=\"#\">{{ticket.etat}}</a>\r\n        \r\n        <h5 :id=\"'pos' + ticket.id\" class=\"position\"></h5>\r\n        <div hidden>{{ this.getPosition(ticket.id) }}</div>\r\n      </section>\r\n    </article>\r\n\r\n  </div>\r\n  \r\n</section>\r\n</div>\r\n<br>\r\n<br>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport SockJS from 'sockjs-client';\r\nimport Stomp from 'stompjs';\r\nexport default {\r\n    name : \"MyTickets\",\r\n    data(){\r\n        return{\r\n            tickets : [],\r\n            position : '',\r\n            infos : {},\r\n        }\r\n    },\r\n    mounted (){\r\n    this.getTickets();\r\n    this.getInfos();\r\n    // Establish a WebSocket connection using SockJS\r\n    const socket = new SockJS(\"http://localhost:8080/web-socket\");\r\n    this.client = Stomp.over(socket);\r\n\r\n    // Handle connection open event\r\n    this.client.connect({}, (frame) => {\r\n      console.log(frame);\r\n      console.log(\"WebSocket connection established.\");\r\n\r\n      // Subscribe to the topic where messages will be received\r\n      this.client.subscribe(\"/topic/queue/user/\"+ this.infos.id, (message) => {\r\n        const body = JSON.parse(message.body);\r\n        console.log(\"Received message:\", body);\r\n\r\n      //  FONCTION ILLY TRAJA3LEK FL POSITION\r\n        let pos = document.getElementById(\"pos\"+body.idTicket);\r\n        pos.innerHTML = \"Position : \"+body.pos\r\n\r\n       if (body.pos == 0){\r\n        let etat = document.getElementById(\"etat\"+body.idTicket);\r\n       etat.innerHTML = \"EN COURS\"\r\n      }\r\n      });\r\n    });\r\n    },\r\n    methods : {\r\n        getTickets(){\r\n            axios.get(\"http://localhost:8080/tickets/today/enCours-enAttente\")\r\n            .then((res) => {\r\n               this.tickets = res.data;\r\n               console.log(res.data);\r\n    \r\n            }).catch((err) => {\r\n                console.log(err)\r\n            });\r\n        },  \r\n        \r\n    async handleAnnuler(id){\r\n        const response = await axios.put(\"http://localhost:8080/tickets/update/annuler/\"+id)\r\n        this.getTickets();\r\n        console.log(response) \r\n       \r\n    },\r\n\r\n     async getPosition(id){\r\n       const response =  await axios.get(\"http://localhost:8080/tickets/queue/\"+id)\r\n       console.log(response.data);\r\n      \r\n       let pos = document.getElementById(\"pos\"+id);\r\n       pos.innerHTML = \"Position : \"+response.data\r\n    },\r\n\r\n     // Send a message to the server\r\n    sendMessage(message) {\r\n      this.client.send(\"/send-message\", {}, message);\r\n    },\r\n\r\n    getInfos(){\r\n            axios.get(\"http://localhost:8080/profile\")\r\n            .then((res) => {\r\n               console.log(res.data)\r\n               this.infos = res.data\r\n            }).catch((err) => {\r\n                console.error(err)\r\n            });\r\n        },\r\n    },\r\n\r\n    computed:{ \r\n        user(){\r\n          return this.$store.state.user;\r\n        },\r\n        type_admin(){\r\n          return this.$store.state.type_admin;\r\n        },\r\n    }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n@import url('https://fonts.googleapis.com/css?family=Oswald');\r\n\r\n\r\n\r\n\r\nh1 {\r\n    text-transform: uppercase;\r\n    font-weight: 900;\r\n    border-left: 10px solid #9e3ffd;\r\n    padding-left: 10px;\r\n    margin-bottom: 30px\r\n}\r\n\r\n\r\n.card {\r\n    display: table-row;\r\n    width: 49%;\r\n    background-color: #faf9f9;\r\n    color: #2a0230;\r\n    margin-bottom: 10px;\r\n    margin-right: 10px;\r\n    font-family: 'Oswald', sans-serif;\r\n    text-transform: uppercase;\r\n    border-radius: 4px;\r\n    position: relative;\r\n}\r\n\r\n\r\n\r\n.date {\r\n    display: table-cell;\r\n    width: 25%;\r\n    position: relative;\r\n    text-align: center;\r\n    border-right: 2px dashed #dadde6\r\n}\r\n\r\n.date:before,\r\n.date:after {\r\n    content: \"\";\r\n    display: block;\r\n    width: 30px;\r\n    height: 30px;\r\n    background-color: #ffffff;\r\n    position: absolute;\r\n    top: -15px;\r\n    right: -15px;\r\n    z-index: 1;\r\n    border-radius: 50%\r\n}\r\n\r\n\r\n.date time {\r\n    display: block;\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    -webkit-transform: translate(-50%, -50%);\r\n    -ms-transform: translate(-50%, -50%);\r\n    transform: translate(-50%, -50%)\r\n}\r\n\r\n.date time span {\r\n    display: block\r\n}\r\n\r\n.date time span:first-child {\r\n    color: #2b2b2b;\r\n    font-weight: 600;\r\n    font-size: 250%\r\n}\r\n\r\n\r\n.card-cont {\r\n    display: table-cell;\r\n    width: 75%;\r\n    font-size: 85%;\r\n    padding: 10px 10px 30px 50px\r\n}\r\n\r\n\r\n.card-cont .even-date i,\r\n.card-cont .even-info i,\r\n.card-cont .even-date time,\r\n.card-cont .even-info p {\r\n    display: table-cell\r\n}\r\n\r\n.card-cont .even-date i,\r\n.card-cont .even-info i {\r\n    padding: 5% 5% 0 0\r\n}\r\n\r\n.card-cont .even-info p {\r\n    padding: 30px 50px 0 0\r\n}\r\n\r\n.card-cont .even-date time span {\r\n    display: block\r\n}\r\n\r\n.card-cont a {\r\n    display: block;\r\n    text-decoration: none;\r\n    width: 80px;\r\n    height: 30px;\r\n    background-color: #D8DDE0;\r\n    color: #ffffff;\r\n    text-align: center;\r\n    line-height: 30px;\r\n    border-radius: 2px;\r\n    position: absolute;\r\n    right: 10px;\r\n    bottom: 10px\r\n}\r\n\r\n\r\n.card-cont a {\r\n    background-color: #faf9f9;\r\n    color : rgb(49, 3, 47);\r\n    border: solid 1px #9e3ffd;\r\n}\r\n\r\n@media screen and (max-width: 860px) {\r\n    .card {\r\n        display: block;\r\n        float: none;\r\n        width: 100%;\r\n        margin-bottom: 10px;\r\n        \r\n    }\r\n    .card+.card {\r\n        margin-left: 0\r\n    }\r\n    .card-cont .even-date,\r\n    .card-cont .even-info {\r\n        font-size: 75%\r\n    }\r\n}\r\n\r\n.container{\r\n    position: absolute;\r\n    top: 150px;\r\n    left: 20px;\r\n}\r\n\r\n\r\nimg{\r\n    position: relative;\r\n    bottom: 130px;\r\n    left: 380px;\r\n    width: 25px;\r\n    height: 35px;\r\n    cursor: pointer;\r\n}\r\n\r\nimg:hover{\r\n   transform: scale(1.05);\r\n}\r\n\r\n.position{\r\n    font-size: 20px;\r\n    text-align: center;\r\n    color: rgb(69, 110, 3);\r\n    position: relative;\r\n\r\n}\r\n\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}